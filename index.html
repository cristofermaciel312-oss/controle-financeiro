<!DOCTYPE html>
<html lang="pt-BR">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1" />
  <title>Controle de Gastos Mensais</title>
  <link rel="manifest" href="manifest.json">
<meta name="theme-color" content="#4CAF50">
  <style>
    * { box-sizing: border-box; }
    :root {
      --bg: #f9f9f9; --text: #222; --muted: #666;
      --primary: #4CAF50; --primary-hover: #45a049;
      --card: #ffffff; --border: #e5e5e5;
    }
    body { margin: 0; font-family: system-ui, -apple-system, 'Inter', Arial, sans-serif; background: var(--bg); color: var(--text); }
    header { display: flex; align-items: center; justify-content: space-between; padding: 16px 20px; background: var(--primary); color: #fff; }
    header h1 { margin: 0; font-size: 1.4rem; }
    .container { max-width: 1100px; margin: 24px auto; padding: 0 16px; }
    section { background: var(--card); border: 1px solid var(--border); border-radius: 12px; padding: 16px; margin-bottom: 16px; }
    section h2 { margin: 0 0 12px; color: var(--muted); font-size: 1.1rem; }
    .grid { display: grid; grid-template-columns: repeat(auto-fit, minmax(240px, 1fr)); gap: 12px; }
    label { display: block; font-size: 0.9rem; margin-bottom: 6px; color: var(--muted); }
    input, select { width: 100%; padding: 10px 12px; border: 1px solid #ccc; border-radius: 10px; background: #fff; color: var(--text); font-size: 0.95rem; }
    input:focus, select:focus { outline: none; border-color: var(--primary); background: #f3fdf5; }
    .actions { display: flex; gap: 10px; flex-wrap: wrap; margin-top: 10px; }
    button { padding: 10px 14px; border: none; border-radius: 10px; background: var(--primary); color: #fff; font-weight: 600; cursor: pointer; }
    button:hover { background: var(--primary-hover); }
    table { width: 100%; border-collapse: collapse; margin-top: 10px; }
    th, td { border: 1px solid #ddd; padding: 10px; text-align: center; font-size: 0.95rem; }
    th { background: var(--primary); color: #fff; }
    tbody tr:nth-child(even) { background: #f6f6f6; }
    .summary p { margin: 6px 0; font-size: 1rem; }
    .toolbar { display: flex; gap: 10px; align-items: center; }
    .link-btn { background: #fff; color: var(--primary); border: 2px solid var(--primary); }
    .link-btn:hover { background: var(--primary); color: #fff; }
    /* Dark mode */
    body.dark { --bg: #121212; --text: #e0e0e0; --muted: #bdbdbd; --primary: #81C784; --primary-hover: #66BB6A; --card: #1e1e1e; --border: #2a2a2a; }
    body.dark input, body.dark select { background: #1a1a1a; color: #e0e0e0; border-color: #3a3a3a; }
    body.dark table th { background: #2a2a2a; color: var(--primary); }
    body.dark tbody tr:nth-child(even) { background: #181818; }
    body.dark tbody tr:nth-child(odd) { background: #202020; }
    /* Transitions */
    body, header, section, input, select, button, table, th, td { transition: background-color 0.25s, color 0.25s, border-color 0.25s; }
  </style>
</head>
<body>
  <header>
    <h1>üí∞ Controle de Gastos Mensais</h1>
    <div class="toolbar">
      <button id="btnHistorico" class="link-btn" type="button">Ver hist√≥rico</button>
      <button id="toggleTheme" type="button">Alternar tema</button>
    </div>
  </header>

  <div class="container">
    <section>
      <h2>Configura√ß√µes do m√™s</h2>
      <div class="grid">
        <div>
          <label for="mesSelecionado">Selecione o m√™s</label>
          <input type="month" id="mesSelecionado" />
        </div>
        <div>
          <label for="dinheiroGuardado">Dinheiro guardado (R$)</label>
          <input type="number" id="dinheiroGuardado" placeholder="0,00" step="0.01" min="0" />
        </div>
      </div>
    </section>

    <section>
      <h2>Adicionar entrada</h2>
      <div class="grid">
        <div>
          <label for="valorReceita">Valor</label>
          <input type="number" id="valorReceita" placeholder="0,00" step="0.01" min="0" />
        </div>
        <div>
          <label for="fonteReceita">Fonte</label>
          <input type="text" id="fonteReceita" placeholder="Ex: Sal√°rio, Freelancer" />
        </div>
        <div>
          <label for="dataReceita">Data</label>
          <input type="date" id="dataReceita" />
        </div>
      </div>
      <div class="actions">
        <button id="btnAddReceita" type="button">Adicionar entrada</button>
      </div>
    </section>

    <section>
      <h2>Adicionar despesa</h2>
      <div class="grid">
        <div>
          <label for="valorDespesa">Valor</label>
          <input type="number" id="valorDespesa" placeholder="0,00" step="0.01" min="0" />
        </div>
        <div>
          <label for="categoriaDespesa">Categoria</label>
          <input type="text" id="categoriaDespesa" placeholder="Ex: Aluguel, Mercado" />
        </div>
        <div>
          <label for="descricaoDespesa">Descri√ß√£o (opcional)</label>
          <input type="text" id="descricaoDespesa" placeholder="Ex: Detalhes da compra" />
        </div>
        <div>
          <label for="dataDespesa">Data</label>
          <input type="date" id="dataDespesa" />
        </div>
      </div>
      <div class="actions">
        <button id="btnAddDespesa" type="button">Adicionar despesa</button>
      </div>
    </section>

    <section>
      <h2>Entradas</h2>
      <table id="tabelaReceitas">
        <thead>
          <tr><th>Valor</th><th>Fonte</th><th>Data</th><th>A√ß√µes</th></tr>
        </thead>
        <tbody></tbody>
      </table>

      <h2 style="margin-top:16px;">Despesas</h2>
      <table id="tabelaDespesas">
        <thead>
          <tr><th>Valor</th><th>Categoria</th><th>Descri√ß√£o</th><th>Data</th><th>A√ß√µes</th></tr>
        </thead>
        <tbody></tbody>
      </table>
    </section>

    <section class="summary">
      <h2>Resumo financeiro</h2>
      <p><strong>Total de entradas:</strong> <span id="totalReceitas">R$ 0,00</span></p>
      <p><strong>Total de despesas:</strong> <span id="totalDespesas">R$ 0,00</span></p>
      <p><strong>Saldo restante:</strong> <span id="saldoRestante">R$ 0,00</span></p>
      <p><strong>Dinheiro guardado:</strong> <span id="saldoGuardado">R$ 0,00</span></p>
      <div class="actions" style="margin-top:12px;">
        <button id="btnSalvarMes" type="button">Salvar m√™s e ir para hist√≥rico</button>
        <button id="btnLimparAtual" class="link-btn" type="button">Limpar p√°gina</button>
      </div>
    </section>
  </div>

  <script>
    document.addEventListener('DOMContentLoaded', () => {
      // Theme persistence
      const savedTheme = localStorage.getItem('theme');
      if (savedTheme === 'dark') document.body.classList.add('dark');

      const el = {
        toggleTheme: document.getElementById('toggleTheme'),
        btnHistorico: document.getElementById('btnHistorico'),
        mesSelecionado: document.getElementById('mesSelecionado'),
        dinheiroGuardado: document.getElementById('dinheiroGuardado'),
        // Receita
        valorReceita: document.getElementById('valorReceita'),
        fonteReceita: document.getElementById('fonteReceita'),
        dataReceita: document.getElementById('dataReceita'),
        btnAddReceita: document.getElementById('btnAddReceita'),
        tabelaReceitasBody: document.getElementById('tabelaReceitas').querySelector('tbody'),
        // Despesa
        valorDespesa: document.getElementById('valorDespesa'),
        categoriaDespesa: document.getElementById('categoriaDespesa'),
        descricaoDespesa: document.getElementById('descricaoDespesa'),
        dataDespesa: document.getElementById('dataDespesa'),
        btnAddDespesa: document.getElementById('btnAddDespesa'),
        tabelaDespesasBody: document.getElementById('tabelaDespesas').querySelector('tbody'),
        // Resumo
        totalReceitas: document.getElementById('totalReceitas'),
        totalDespesas: document.getElementById('totalDespesas'),
        saldoRestante: document.getElementById('saldoRestante'),
        saldoGuardado: document.getElementById('saldoGuardado'),
        // A√ß√µes
        btnSalvarMes: document.getElementById('btnSalvarMes'),
        btnLimparAtual: document.getElementById('btnLimparAtual'),
      };

      let receitas = [];
      let despesas = [];
      let nextId = 1;

      const brl = (n) => (n || 0).toLocaleString('pt-BR', { style: 'currency', currency: 'BRL' });
      const formatDate = (value) => {
        if (!value) return '';
        const d = new Date(value + 'T00:00:00');
        return d.toLocaleDateString('pt-BR');
      };
      const monthKey = (inputMonth) => {
        // input type="month" ‚Üí "YYYY-MM"
        if (!inputMonth) return '';
        const [y, m] = inputMonth.split('-');
        const nomes = ['Janeiro','Fevereiro','Mar√ßo','Abril','Maio','Junho','Julho','Agosto','Setembro','Outubro','Novembro','Dezembro'];
        return `${nomes[Number(m)-1]} ${y}`;
      };

      function renderReceitas() {
        el.tabelaReceitasBody.innerHTML = receitas.map(r => `
          <tr data-id="${r.id}">
            <td>${brl(r.valor)}</td>
            <td>${r.fonte}</td>
            <td>${formatDate(r.data)}</td>
            <td><button class="rem-receita" data-id="${r.id}">üóëÔ∏è</button></td>
          </tr>
        `).join('');
      }
      function renderDespesas() {
        el.tabelaDespesasBody.innerHTML = despesas.map(d => `
          <tr data-id="${d.id}">
            <td>${brl(d.valor)}</td>
            <td>${d.categoria}</td>
            <td>${d.descricao || '-'}</td>
            <td>${formatDate(d.data)}</td>
            <td><button class="rem-despesa" data-id="${d.id}">üóëÔ∏è</button></td>
          </tr>
        `).join('');
      }
      function resumo() {
        const totalR = receitas.reduce((acc, r) => acc + (Number(r.valor) || 0), 0);
        const totalD = despesas.reduce((acc, d) => acc + (Number(d.valor) || 0), 0);
        const guardado = parseFloat(el.dinheiroGuardado.value) || 0;
        el.totalReceitas.textContent = brl(totalR);
        el.totalDespesas.textContent = brl(totalD);
        el.saldoRestante.textContent = brl(totalR - totalD);
        el.saldoGuardado.textContent = brl(guardado);
      }

      function resetReceitaInputs() {
        el.valorReceita.value = ''; el.fonteReceita.value = ''; el.dataReceita.value = '';
      }
      function resetDespesaInputs() {
        el.valorDespesa.value = ''; el.categoriaDespesa.value = ''; el.descricaoDespesa.value = ''; el.dataDespesa.value = '';
      }
      function limparPagina() {
        receitas = []; despesas = []; nextId = 1;
        el.dinheiroGuardado.value = '';
        renderReceitas(); renderDespesas(); resumo();
      }

      // Add receita
      el.btnAddReceita.addEventListener('click', () => {
        const valor = parseFloat(el.valorReceita.value);
        const fonte = (el.fonteReceita.value || '').trim();
        const data = el.dataReceita.value;
        if (!valor || valor <= 0 || !fonte || !data) {
          alert('Preencha valor, fonte e data da entrada.');
          return;
        }
        receitas.push({ id: nextId++, valor, fonte, data });
        renderReceitas(); resumo(); resetReceitaInputs();
      });

      // Add despesa (descri√ß√£o opcional)
      el.btnAddDespesa.addEventListener('click', () => {
        const valor = parseFloat(el.valorDespesa.value);
        const categoria = (el.categoriaDespesa.value || '').trim();
        const descricao = (el.descricaoDespesa.value || '').trim();
        const data = el.dataDespesa.value;
        if (!valor || valor <= 0 || !categoria || !data) {
          alert('Preencha valor, categoria e data da despesa.');
          return;
        }
        despesas.push({ id: nextId++, valor, categoria, descricao, data });
        renderDespesas(); resumo(); resetDespesaInputs();
      });

      // Remove receita/despesa
      el.tabelaReceitasBody.addEventListener('click', (e) => {
        const btn = e.target.closest('.rem-receita'); if (!btn) return;
        const id = Number(btn.dataset.id);
        receitas = receitas.filter(r => r.id !== id);
        renderReceitas(); resumo();
      });
      el.tabelaDespesasBody.addEventListener('click', (e) => {
        const btn = e.target.closest('.rem-despesa'); if (!btn) return;
        const id = Number(btn.dataset.id);
        despesas = despesas.filter(d => d.id !== id);
        renderDespesas(); resumo();
      });

      // Save month
      el.btnSalvarMes.addEventListener('click', () => {
        const mKey = monthKey(el.mesSelecionado.value);
        if (!mKey) { alert('Selecione o m√™s antes de salvar.'); return; }
        const guardado = parseFloat(el.dinheiroGuardado.value) || 0;
        const payload = { receitas, despesas, guardado, salvoEm: new Date().toISOString() };

        const histRaw = localStorage.getItem('financeHistory');
        const hist = histRaw ? JSON.parse(histRaw) : {};
        hist[mKey] = payload;
        localStorage.setItem('financeHistory', JSON.stringify(hist));

        limparPagina(); // prepara p√°gina para pr√≥ximo m√™s
        window.location.href = 'historico.html';
      });

      // Limpar p√°gina atual (sem salvar)
      el.btnLimparAtual.addEventListener('click', limparPagina);

      // Ver hist√≥rico
      el.btnHistorico.addEventListener('click', () => {
        window.location.href = 'historico.html';
      });

      // Dinheiro guardado muda resumo
      el.dinheiroGuardado.addEventListener('input', resumo);

      // Theme toggle
      el.toggleTheme.addEventListener('click', () => {
        document.body.classList.toggle('dark');
        localStorage.setItem('theme', document.body.classList.contains('dark') ? 'dark' : 'light');
      });

      // Prefill current month
      const today = new Date();
      const ym = `${today.getFullYear()}-${String(today.getMonth()+1).padStart(2,'0')}`;
      el.mesSelecionado.value = ym;

      // Init
      renderReceitas(); renderDespesas(); resumo();
    });
    if ("serviceWorker" in navigator) {
  navigator.serviceWorker.register("service-worker.js")
    .then(() => console.log("Service Worker registrado com sucesso"))
    .catch(err => console.log("Erro no Service Worker:", err));
}

  </script>
</body>
</html>
